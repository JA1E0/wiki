
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="aWei">
      
      
        <link rel="canonical" href="https://wiki.noobwei.top/computer/security/malware/YARA/creating_yara/">
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.1, mkdocs-material-7.1.9">
    
    
      
        <title>编写Yara规则检测恶意软件 - aWei's Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.f1a3b89f.min.css">
        
          
          
          <meta name="theme-color" content="#7e56c2">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple">
  
    
    <script>function __prefix(e){return new URL("../../../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="aWei&#39;s Wiki" class="md-header__button md-logo" aria-label="aWei's Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            aWei's Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              编写Yara规则检测恶意软件
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../../windows_kernel_programming/msdn/" class="md-tabs__link md-tabs__link--active">
        计算机
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../buy_someting/gh60/1_gh60_edition/" class="md-tabs__link">
        选购商品
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../tool/common_code.md" class="md-tabs__link">
        工具
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../entertainment/" class="md-tabs__link">
        娱乐
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../../todo/" class="md-tabs__link">
      TODO
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="aWei&#39;s Wiki" class="md-nav__button md-logo" aria-label="aWei's Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    aWei's Wiki
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      <label class="md-nav__link" for="__nav_1">
        计算机
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="计算机" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          计算机
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1" data-md-state="indeterminate" type="checkbox" id="__nav_1_1" checked>
      
      <label class="md-nav__link" for="__nav_1_1">
        windows内核编程
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="windows内核编程" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_1">
          <span class="md-nav__icon md-icon"></span>
          windows内核编程
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../windows_kernel_programming/msdn/" class="md-nav__link">
        官方文档快速查询
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../windows_kernel_programming/" class="md-nav__link">
        内核笔记快速查询
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../windows_kernel_programming/template/" class="md-nav__link">
        内核基础模板
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" data-md-state="indeterminate" type="checkbox" id="__nav_1_2" checked>
      
      <label class="md-nav__link" for="__nav_1_2">
        windows编程
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="windows编程" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          windows编程
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../windows_core_programming/Calling_convention/" class="md-nav__link">
        调用约定
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../windows_core_programming/Inject/" class="md-nav__link">
        各种注入提示
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../windows_core_programming/multi_thread/" class="md-nav__link">
        多线程有关
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" checked>
      
      <label class="md-nav__link" for="__nav_1_3">
        病毒分析
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="病毒分析" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          病毒分析
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3_1" type="checkbox" id="__nav_1_3_1" checked>
      
      <label class="md-nav__link" for="__nav_1_3_1">
        YARA
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="YARA" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_3_1">
          <span class="md-nav__icon md-icon"></span>
          YARA
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          编写Yara规则检测恶意软件
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        编写Yara规则检测恶意软件
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    简介
  </a>
  
    <nav class="md-nav" aria-label="简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    阅读本文需要的知识
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    声明
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    大纲
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    规则标识符
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yara" class="md-nav__link">
    Yara关键字
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    十六进制字符串
  </a>
  
    <nav class="md-nav" aria-label="十六进制字符串">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    通配符
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    不定长通配符
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    有条件的字符串
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    混合
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    文本字符串
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    修饰符
  </a>
  
    <nav class="md-nav" aria-label="修饰符">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    不区分大小写的字符串
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    宽字符串
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fullwords" class="md-nav__link">
    Fullwords修饰符
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    正则表达式
  </a>
  
    <nav class="md-nav" aria-label="正则表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    元字符
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    字符串集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#offorof" class="md-nav__link">
    带有of和for...of的匿名字符串
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    条件
  </a>
  
    <nav class="md-nav" aria-label="条件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    布尔运算
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    计数字符串实例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    字符串偏移(虚拟地址)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    匹配长度
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    文件大小
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    可执行程序入口点
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    访问指定位置的数据
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forof" class="md-nav__link">
    for…of: 对许多字符串应用同一个条件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    迭代字符串出现次数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    引用其他规则
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yara_1" class="md-nav__link">
    Yara要点
  </a>
  
    <nav class="md-nav" aria-label="Yara要点">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    全局规则
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    私有规则
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    规则标签
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    元数据
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    使用模块
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    未定义的值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    外部变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    文件包含
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    总结
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../yara_docs/" class="md-nav__link">
        官方文档与signature
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Kaspersky_yara_note/" class="md-nav__link">
        卡巴斯基yara笔记
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../office_cve/" class="md-nav__link">
        Office常见CVE
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4" data-md-state="indeterminate" type="checkbox" id="__nav_1_4" checked>
      
      <label class="md-nav__link" for="__nav_1_4">
        威胁情报
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="威胁情报" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          威胁情报
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../threat_intelligence/awesome-threat-intelligence/" class="md-nav__link">
        威胁情报大合集
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../threat_intelligence/OSINT/bookmarks_menu/" class="md-nav__link">
        OSINT 书签
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../threat_intelligence/OSINT/OSINT_framework/" class="md-nav__link">
        OSINT 框架
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_5" data-md-state="indeterminate" type="checkbox" id="__nav_1_5" checked>
      
      <label class="md-nav__link" for="__nav_1_5">
        Web
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Web" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_5">
          <span class="md-nav__icon md-icon"></span>
          Web
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../WEB/Practice_platform/" class="md-nav__link">
        Web练习平台
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../WEB/Linux_Privilege_Escalation/" class="md-nav__link">
        linux特权提升
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../hw_redteam/" class="md-nav__link">
        分析tips-redteam使用工具
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        选购商品
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="选购商品" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          选购商品
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" data-md-state="indeterminate" type="checkbox" id="__nav_2_1" checked>
      
      <label class="md-nav__link" for="__nav_2_1">
        GH60 客制化键盘
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="GH60 客制化键盘" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          GH60 客制化键盘
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../buy_someting/gh60/1_gh60_edition/" class="md-nav__link">
        0x01 GH60的各种版本
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../buy_someting/gh60/2_gh60_Materials/" class="md-nav__link">
        0x02 GH60的零件清单
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../buy_someting/gh60/3_gh60_install/" class="md-nav__link">
        0x03 GH60的拼装
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" data-md-state="indeterminate" type="checkbox" id="__nav_2_2" checked>
      
      <label class="md-nav__link" for="__nav_2_2">
        烤箱
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="烤箱" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          烤箱
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../buy_someting/oven_%E5%BE%AE%E6%B3%A2%E7%82%89/1_oven_knowledge/" class="md-nav__link">
        烤箱选购
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../buy_someting/oven_%E5%BE%AE%E6%B3%A2%E7%82%89/2_oven_experience/" class="md-nav__link">
        使用心得
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" data-md-state="indeterminate" type="checkbox" id="__nav_2_3" checked>
      
      <label class="md-nav__link" for="__nav_2_3">
        厨刀
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="厨刀" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          厨刀
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../buy_someting/knife/knife/" class="md-nav__link">
        厨刀推荐
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" data-md-state="indeterminate" type="checkbox" id="__nav_2_4" checked>
      
      <label class="md-nav__link" for="__nav_2_4">
        跑步
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="跑步" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          跑步
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../buy_someting/running/jogging_winter/" class="md-nav__link">
        秋冬夜跑
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        工具
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="工具" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          工具
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tool/common_code.md" class="md-nav__link">
        None
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tool/tools.md" class="md-nav__link">
        None
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tool/keyboard_shortcuts.md" class="md-nav__link">
        None
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tool/vscode_shortcuts.md" class="md-nav__link">
        None
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tool/disassembly_simulation.md" class="md-nav__link">
        None
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" data-md-state="indeterminate" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        娱乐
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="娱乐" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          娱乐
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../entertainment/" class="md-nav__link">
        没事就看片
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../todo/" class="md-nav__link">
        TODO
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    简介
  </a>
  
    <nav class="md-nav" aria-label="简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    阅读本文需要的知识
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    声明
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    大纲
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    规则标识符
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yara" class="md-nav__link">
    Yara关键字
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    十六进制字符串
  </a>
  
    <nav class="md-nav" aria-label="十六进制字符串">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    通配符
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    不定长通配符
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    有条件的字符串
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    混合
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    文本字符串
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    修饰符
  </a>
  
    <nav class="md-nav" aria-label="修饰符">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    不区分大小写的字符串
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    宽字符串
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fullwords" class="md-nav__link">
    Fullwords修饰符
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    正则表达式
  </a>
  
    <nav class="md-nav" aria-label="正则表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    元字符
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    字符串集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#offorof" class="md-nav__link">
    带有of和for...of的匿名字符串
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    条件
  </a>
  
    <nav class="md-nav" aria-label="条件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    布尔运算
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    计数字符串实例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    字符串偏移(虚拟地址)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    匹配长度
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    文件大小
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    可执行程序入口点
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    访问指定位置的数据
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forof" class="md-nav__link">
    for…of: 对许多字符串应用同一个条件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    迭代字符串出现次数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    引用其他规则
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yara_1" class="md-nav__link">
    Yara要点
  </a>
  
    <nav class="md-nav" aria-label="Yara要点">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    全局规则
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    私有规则
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    规则标签
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    元数据
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    使用模块
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    未定义的值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    外部变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    文件包含
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    总结
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>编写Yara规则检测恶意软件</h1>
                
                <p>​   date: 2020-02-19</p>
<blockquote>
<p>​ 翻译者: <a href="https://bbs.pediy.com/user-722644.htm">Vancir</a> </p>
<p><a href="https://bbs.pediy.com/thread-226011.htm">https://bbs.pediy.com/thread-226011.htm</a></p>
</blockquote>
<h2 id="_1">简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>我们都知道, 黑掉漏洞百出的代码比修补代码有趣得多. 但只会入侵的黑客并不一定能满足雇主的需求. 一些公司就希望安全研究人员能够基于他们收集和发现的恶意软件样本或泄露数据进行补丁.</p>
<p>本文适合人群: 新手和爱好者</p>
<h3 id="_2">阅读本文需要的知识<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>其实并不需要太多知识要求, 当你对恶意软件分析和逆向工程理解越深, 你就越有独特的方式捕获恶意软件. 不过这并不妨碍你写出惊人的yara规则出来. 我所见过的大部分规则都相当基础. 大部分看上去就像5分钟就能写好的python脚本. 编写规则, yara规则本身十分简单, 真正的技巧和细节都在分析部分 .</p>
<ul>
<li>熟悉GNU Linux</li>
<li>熟悉C语言语法(不作要求, 但十分有用)</li>
<li>正则表达式 (同上, 不作要求, 但很有用)</li>
</ul>
<h3 id="_3">声明<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>我是自学yara规则, 学校并没有教我这些. 我学习yara大约有30个小时, 花费了我一个周末的时间.</p>
<h2 id="_4">大纲<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>我将介绍以下内容:</p>
<ol>
<li>规则标识符</li>
<li>Yara关键字</li>
<li>字符串</li>
<li>十六进制值</li>
<li>文本字符串</li>
<li>字符串修饰符</li>
<li>正则表达式</li>
<li>字符串集</li>
<li>匿名字符串</li>
<li>条件</li>
<li>布尔值</li>
<li>字符串实例计数</li>
<li>字符串偏移或虚拟地址</li>
<li>匹配长度</li>
<li>文件大小</li>
<li>可执行程序入口点</li>
<li>访问指定位置的数据</li>
<li>对多字符串应用同一条件</li>
<li>迭代字符串出现次数</li>
<li>引用其他规则</li>
<li>Yara要点</li>
<li>全局规则</li>
<li>私有规则</li>
<li>规则标签</li>
<li>元数据</li>
<li>使用模块</li>
<li>未定义值</li>
<li>外部变量/参数值</li>
<li>文件包含</li>
</ol>
<p>让我们现在开始吧.</p>
<hr />
<p>Yara规则与C语言语法十分相像, 以下是一个简单的规则, 这个规则没有进行任何操作:</p>
<div class="highlight"><pre><span></span><code>rule HelloRule
{
    condition:
    false
}
</code></pre></div>
<h2 id="_5">规则标识符<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>规则标识符是上面简单规则示例中跟在<code>rule</code>后的词, 比如单词"dummy"也可以是一个规则标识符, 标识符命名有如下要求:</p>
<ul>
<li>是由英文字母或数字组成的字符串</li>
<li>可以使用下划线字符</li>
<li>第一个字符不能是数字</li>
<li>对大小写敏感</li>
<li>不能超出128个字符长度</li>
</ul>
<h2 id="yara">Yara关键字<a class="headerlink" href="#yara" title="Permanent link">&para;</a></h2>
<p>下面这些词不能用作规则标识符, 因为这些单词在yara语言里有特定用处</p>
<blockquote>
<p>all, and, any, ascii, at, condition, contains entrypoint, false, filesize, fullword, for, global, in import, include, int8, nt16, int32, int8be, int16be int32be, matches, meta, nocase, not, or, of private, rule, strings, them, true, uint8, uint16 uint32, int8be, uint16be, uint32be, wide</p>
</blockquote>
<p>通常yara规则有两部分: <strong>字符串定义**和**条件</strong></p>
<div class="highlight"><pre><span></span><code>rule HelloRule2    // This is an example
{
    strings:
        $my_text_string = &quot;text here&quot;
        $my_hex_string = { E2 34 A1 C8 23 FB }

    condition:
        $my_text_string or $my_hex_string
}
</code></pre></div>
<p>当发现有规则里定义的任意字符串, 规则就会生效. 如你所见, 你还可以在规则里添加注释.</p>
<h2 id="_6">十六进制字符串<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<h3 id="_7">通配符<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>十六进制字符串可以用通配符表示, 通配符符号用"?"表示</p>
<div class="highlight"><pre><span></span><code>rule GambitWildcard
{
    strings:
       $hex_string = { EF 44 ?? D8 A? FB }

    condition:
       $hex_string
}
</code></pre></div>
<p>这个规则可以匹配下面的两个字符串</p>
<div class="highlight"><pre><span></span><code>EF 44 01 D8 AA FB
EF 44 AA D8 AB FB
</code></pre></div>
<h3 id="_8">不定长通配符<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>不定长的字符串可以用下面这个方法表示</p>
<div class="highlight"><pre><span></span><code>rule MarioJump
{
        strings:
           $hex_string = { F4 23 [4-6] 62 B4 }

        condition:
           $hex_string
}
</code></pre></div>
<p>这个规则可以匹配下面的两个字符串</p>
<div class="highlight"><pre><span></span><code>F4 23 01 02 03 04 62 B4
F4 23 AA BB CC DD EE FF 62 B4
</code></pre></div>
<p>当然无限长的字符串也是可以的.</p>
<div class="highlight"><pre><span></span><code>rule BuzzLightyear
{
        strings:
           $hex_string = { F4 23 [-] 62 B4 }

        condition:
           $hex_string
}
</code></pre></div>
<p>这个规则可以匹配下面的两个字符串</p>
<div class="highlight"><pre><span></span><code>F4 23 AA FF 62 B4
F4 23 AA AA AA AA AA...FF FF 62 B4
</code></pre></div>
<h3 id="_9">有条件的字符串<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>你可以创建一个字符串应对多种情况</p>
<div class="highlight"><pre><span></span><code>rule WorriedRabbit
{
    strings:
       $hex_string = { BA 21 ( DA BC | C6 ) A5 }

    condition:
       $hex_string
}
</code></pre></div>
<p>这个规则可以匹配下面的两个字符串</p>
<div class="highlight"><pre><span></span><code>BA 21 DA BC A5
BA 21 C6 A5
</code></pre></div>
<h3 id="_10">混合<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>当然, 你也可以将上面这几种方法结合起来.</p>
<div class="highlight"><pre><span></span><code>rule WorriedGabmitLightyearJump
{
    strings:
       $hex_string = { BA ?? ( DA [2-4] | C6 ) A5 }

    condition:
       $hex_string
}
</code></pre></div>
<p>这个规则可以匹配下面的三个字符串</p>
<div class="highlight"><pre><span></span><code>BA 01 DA 01 02 03 04 A5
BA AA C6 A5
BA FF DA 01 02 A5
</code></pre></div>
<h2 id="_11">文本字符串<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<p>除开使用十六进制字符串, 我们也还可以使用文本字符串</p>
<div class="highlight"><pre><span></span><code>rule KimPossible
{
    strings:
        $alert_string = &quot;Whats the Sitch&quot;

    condition:
       $alert_string
}
</code></pre></div>
<p>你也可以像C语言那样使用如下的转义符:</p>
<div class="highlight"><pre><span></span><code>\&quot; 双引号
\\ 反斜杠
\t 水平制表符
\n 换行符
\xdd 以十六进制表示的任何字节
</code></pre></div>
<h2 id="_12">修饰符<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h2>
<h3 id="_13">不区分大小写的字符串<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p>Yara规则默认对大小写敏感, 但你可以使用修饰符将其关闭</p>
<div class="highlight"><pre><span></span><code>rule ThickSkin
{
    strings:
        $strong_string = &quot;Iron&quot; nocase

    condition:
        $strong_string
}
</code></pre></div>
<h3 id="_14">宽字符串<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p><code>wide</code>修饰符可以用来搜寻以2字节表示1字符这种方式编码的字符串, 这种宽字符串在许多二进制文件中都有出现. 如果字符串"FatTony"以2字节表示1字符的方式编码并在二进制文件中出现, 我们就可以使用<code>wide</code>修饰符将其捕获. 因为"FatTony"也可能是"fattony", 我们也可以添加<code>nocase</code>修饰符以免错过.</p>
<div class="highlight"><pre><span></span><code>rule FatTony
{
    strings:
        $fat_villain = &quot;FatTony&quot; wide nocase

    condition:
        $fat_villain
}
</code></pre></div>
<p>[!]重要提示: 请记住, 该修饰符只是将字符串中字符的ASCII码和\x00交错起来组成宽字符, 它并不支持包含非英文字符的UTF-16字符串. 要想对既有ASCII字符和宽字符的字符串进行搜索, 请使用如下命令:</p>
<div class="highlight"><pre><span></span><code>rule ASCIIFatTony
{
    strings:
        $fat_villain = &quot;FatTony&quot; wide ascii nocase

    condition:
        $fat_villain
}
</code></pre></div>
<p>字符串默认是ASCII编码, 所以如果你想单独用<code>ascii</code>搜索"FatTony", 你并不需要添加<code>ascii</code>修饰符</p>
<div class="highlight"><pre><span></span><code>rule ASCIIFatTony
{
    strings:
        $fat_villain = &quot;FatTony&quot;

    condition:
        $fat_villain
}
</code></pre></div>
<p>如果你想在不使用<code>wide</code>和<code>nocase</code>修饰符的情况下进行搜索, 上述这个规则可以生效.</p>
<h3 id="fullwords">Fullwords修饰符<a class="headerlink" href="#fullwords" title="Permanent link">&para;</a></h3>
<p>该修饰符可用于匹配那些前后没有附加其他字符的单词(全词匹配).</p>
<div class="highlight"><pre><span></span><code>rule ShadyDomain
{
    strings:
        $shady_domain = &quot;faceebook&quot; fullword

    condition:
       $shady_domain
}
</code></pre></div>
<p>这个规则可以匹配下面的三个字符串</p>
<div class="highlight"><pre><span></span><code>www.faceebook.com
www.myportal.faceebook.com
https://secure.faceebook.com
</code></pre></div>
<p>但这个规则**不能**匹配以下的字符串:</p>
<div class="highlight"><pre><span></span><code>www.myfaceebook.com
thefaceebook.com
</code></pre></div>
<p>两者区别在于匹配的全词前后可以附加特殊字符, 不能是普通字符.</p>
<h2 id="_15">正则表达式<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h2>
<p>yara规则允许使用正则表达式, 不过要用正斜杠而非双引号括起来使用(像Perl编程那样)</p>
<div class="highlight"><pre><span></span><code>rule RegularShow
{
    strings:
        $re1 = /md5: [0-9a-fA-F]{32}/
        $re2 = /state: (on|off)/

    condition:
        $re1 and $re2
}
</code></pre></div>
<p>该规则将捕获任何状态下找到的所有md5字符串.</p>
<p>你也可以在正则表达式中使用文本修饰符, 如**nocase**,<strong>ascii</strong>,<strong>wide**和**fullword</strong>.</p>
<h3 id="_16">元字符<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p>元字符是一个字符对计算机程序有特定含义(而非字面含义)的字符. 在正则表达式中, 有以下含义:</p>
<div class="highlight"><pre><span></span><code>** 引用下一个元字符
^ 匹配文件的开头
$ 匹配文件的末尾
| 多选
() 分组
[] 方括号字符类
</code></pre></div>
<p>也可以使用以下量词:</p>
<div class="highlight"><pre><span></span><code>* 匹配0次或多次
+ 匹配1次或多次
? 匹配0次或1次
{n} 只匹配n次
{n, } 至少匹配n次
{ ,m} 至多匹配m次
{n,m} 匹配n到m次
</code></pre></div>
<p>也可以使用以下的转义符:</p>
<div class="highlight"><pre><span></span><code>\t 水平制表符 (HT, TAB)
\n 换行符 (LF, NL)
\r 回车符 (CR)
\f 换页符 (FF)
\a 响铃
\xNN 十六进制代码为NN的字符
</code></pre></div>
<p>也可以使用以下字符类:</p>
<div class="highlight"><pre><span></span><code>\w 匹配单词字符 (单词可由字母数字加&quot;_&quot;组成)
\W 匹配非单词字符
\s 匹配空白符
\S 匹配非空白字符
\d 匹配一个十进制数字字符
\D 匹配一个非数字字符
\b 匹配单词边界
\B 匹配非单词边界
</code></pre></div>
<h3 id="_17">字符串集<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p>如果你想要中列表中选择一定数量的字符串, 你可以执行以下操作:</p>
<div class="highlight"><pre><span></span><code>rule MigosPresent
{
    strings:
        $m1 = &quot;Quavo&quot;
        $m2 = &quot;Offset&quot;
        $m3 = &quot;Takeoff&quot;

    condition:
        2 of ($m1,$m2,$m3)
}
</code></pre></div>
<p>如果<code>$m1</code>, <code>$m2</code>和<code>$m3</code>任意存在两个, 那么就满足上述规则中的条件.</p>
<p>你还可以使用通配符来表示一个字符集. 像如下这样使用通配符<code>*</code></p>
<div class="highlight"><pre><span></span><code>rule MigosPresent
{
    strings:
        $m1 = &quot;Quavo&quot;
        $m2 = &quot;Offset&quot;
        $m3 = &quot;Takeoff&quot;

    condition:
        2 of ($m*)
}
</code></pre></div>
<p>要表示<code>strings</code>中的所有变量, 你可以使用关键字<code>them</code></p>
<div class="highlight"><pre><span></span><code>rule ThreeRappersPresent
{
    strings:
        $m1 = &quot;Quavo&quot;
        $m2 = &quot;Offset&quot;
        $m3 = &quot;Takeoff&quot;
        $q1 = &quot;Cardi B&quot;

    condition:
        3 of them // equivalent to 3 of ($*)
}
</code></pre></div>
<p>你可以使用任何返回数值的表达式. 以下是使用关键字<code>any</code>和<code>all</code>的一个示例</p>
<div class="highlight"><pre><span></span><code>rule Squad
{
    strings:
        $m1 = &quot;Quavo&quot;
        $m2 = &quot;Offset&quot;
        $m3 = &quot;Takeoff&quot;
        $q1 = &quot;Cardi B&quot;

    condition:
        3 of them // equivalent to 3 of ($*)
        all of them
        any of ($*) and 2 of ($*)    // Fancy way of using any in a rule that requires 3.
}
</code></pre></div>
<h3 id="offorof">带有of和for...of的匿名字符串<a class="headerlink" href="#offorof" title="Permanent link">&para;</a></h3>
<p>如果你没有专门引用字符串的事件, 你可以仅使用<code>$</code>来将它们全部引用.</p>
<div class="highlight"><pre><span></span><code>rule AnonymousStrings
{
    strings:
        $ = &quot;dummy1&quot;
        $ = &quot;dummy2&quot;

    condition:
        1 of them
}
</code></pre></div>
<h2 id="_18">条件<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h2>
<p>Yara规则允许通过and, or, 和not等相关运算符来表示布尔表达式, 算术运算符(+,-,*,%)和位运算符(&amp;, |, &lt;&lt;, &gt;&gt;, ~, ^)也可用于数值表达式中.</p>
<h3 id="_19">布尔运算<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p>字符串标识符也可在条件中充当布尔变量, 其值取决于文件中相关字符串是否存在.</p>
<div class="highlight"><pre><span></span><code>rule Example
{
    strings:
        $hero1a = &quot;Batman&quot;
        $hero1b = &quot;Robin&quot;
        $hero2a = &quot;Edward&quot;
        $hero2b = &quot;Alphonse&quot;

    condition:
        ($hero1a or $hero1b) and ($hero2a or $hero2b)
}
</code></pre></div>
<h3 id="_20">计数字符串实例<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<p>有时我们不仅需要知道某个字符串是否存在, 还需要知道字符串在文件或进程内存中出现的次数. 每个字符串的出现次数由一个变量表示, 变量名是用<code>#</code>代替<code>$</code>的字符串标识符. 例如:</p>
<div class="highlight"><pre><span></span><code>rule Ransomware
{
    strings:
        $a = &quot;encrypted&quot;
        $b = &quot;btc&quot;

    condition:
        #a == 2 and #b &gt; 2
}
</code></pre></div>
<p>这个规则会匹配任何包含两个字符串<code>$a</code>以及出现至少两次字符串<code>$b</code>的文件或进程.</p>
<h3 id="_21">字符串偏移(虚拟地址)<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h3>
<p>在大多数情况下, 当在条件中使用字符串标识符, 我们都只需知道关联的字符串是否在文件或进程内存内就行了. 但有时我们还是需要知道该字符串是否在文件的某个特定偏移处, 或是在进程地址空间的某个虚拟地址处. 在这种情况下, 我们就需要操作符<code>at</code>.</p>
<div class="highlight"><pre><span></span><code>rule Offset
{
    strings:
        $a = &quot;encrypted&quot;
        $b = &quot;btc&quot;

    condition:
        $a at 100 and $b at 200
}
</code></pre></div>
<p>如果在文件的偏移100处(或者在一个正在运行的进程中, 位于虚拟地址100位置)发现了字符串<code>$a</code>, 我们的规则就能捕获到该字符串. 当然字符串<code>$b</code>也要在偏移200位置上才行. 你也可以使用十六进制表示而不一定要十进制.</p>
<div class="highlight"><pre><span></span><code>rule Offset
{
    strings:
        $a = &quot;encrypted&quot;
        $b = &quot;btc&quot;

    condition:
        $a at 0x64 and $b at 0xC8
}
</code></pre></div>
<p><code>at</code>操作符指定到一个具体的偏移量, 而你可以使用操作符<code>in</code>来指定字符串的位置范围.</p>
<div class="highlight"><pre><span></span><code>rule InExample
{
    strings:
        $a = &quot;encrypted&quot;
        $b = &quot;btc&quot;

    condition:
        $a in (0..100) and $b in (100..filesize)
}
</code></pre></div>
<p>字符串<code>$a</code>必须在偏移0-100之间才能找到, 而<code>$b</code>则必须是在偏移100到文件末尾位置(才能找到).</p>
<p>你也可以使用<code>@a[i]</code>来取得字符串<code>$a</code>第<code>i</code>个字符的偏移量或虚拟地址. 字符串索引以<code>1</code>开头 , 故第1个字符是<code>@a[1]</code>, 第2个是<code>@[a2]</code>并依此类推, 而不是以<code>@a[0]</code>开始. 如果你提供的索引值大过字符串总共出现的次数. 那结果就将是值<code>NaN</code>(Not a Number, 非数字).</p>
<h3 id="_22">匹配长度<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<p>对于包含跳转的许多正则表达式和十六进制字符串, 匹配长度用一个变量表示. 如果你有一个正则表达式<code>/fo*/</code>, 可以匹配字符串<code>fo</code>, <code>foo</code>和<code>fooo</code>, 那么各个的匹配长度都是不同的.</p>
<p>在字符串标识符前加一个<code>!</code>得到匹配长度, 你就可以将匹配长度作为你条件的一部分. 跟你获取偏移时使用字符<code>@</code>类似, <code>!a[1]</code>是第一个匹配到的字符串<code>$a</code>的长度, 而<code>!a[2]</code>就是第二个匹配到的字符串的长度, 依此类推. <code>!a</code>是<code>!a[1]</code>的缩写.</p>
<div class="highlight"><pre><span></span><code>rule Hak5
{
    strings:
        $re1 = /hack*/    // Will catch on hacker, hacked, hack, hack*

    condition:
        !re1[1] == 4 and !re1[2] &gt; 6
}
</code></pre></div>
<p>该规则可以匹配如下字符串:</p>
<div class="highlight"><pre><span></span><code>We hack things. We are hackers.
</code></pre></div>
<p>第一个<code>hack</code>是<code>re1[1]</code>且其长度等于4. 第二个<code>hack</code>长度则至少为6</p>
<h3 id="_23">文件大小<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<p>字符串标识符并不是唯一可以在条件中出现的变量(实际上, 可以不定义任何字符串来编写一个规则), 还可以使用其他变量. <code>filesize</code>就保存着正在扫描的文件的大小. 大小以字节为单位.</p>
<div class="highlight"><pre><span></span><code>rule FileSizeExample
{
    condition:
       filesize &gt; 200KB
}
</code></pre></div>
<p>我们可以使用后缀<code>KB</code>将文件大小设置为<code>200KB</code>, 它会自动将常量的值乘上1024, 后缀<code>MB</code>会可以将值乘以<code>2^20</code>. 这两个后缀都只能用于十进制常量</p>
<p>[!]重要提示: <code>filesize</code>仅在规则应用于文件的时候生效. 如果应用于正在运行的进程, 那么它会永远都匹配不了.</p>
<h3 id="_24">可执行程序入口点<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<p>如果我们正扫描的文件是一个PE或ELF文件, 那么变量<code>entry_point</code>会存有可执行文件的入口点偏移值. 而如果我们正扫描一个运行的进程, 那么<code>entry_point</code>会存有可执行文件入口点的虚拟地址. 变量<code>entry_point</code>的经典用法是用于搜索入口点的一些pattern, 以检测壳或简单的感染病毒. 目前使用<code>entry_point</code>的方式是通过导入PE和/或ELF的库并使用它们各自的功能. Yara的<code>entrypoint</code>函数自第3版开始就已经过时了. 以下是它在第3版之前的样子.</p>
<div class="highlight"><pre><span></span><code>rule EntryPointExample1
{
    strings:
        $a = { E8 00 00 00 00 }

    condition:
       $a at entrypoint
}

rule EntryPointExample2
{
    strings:
        $a = { 9C 50 66 A1 ?? ?? ?? 00 66 A9 ?? ?? 58 0F 85 }

    condition:
       $a in (entrypoint..entrypoint + 10)
}
</code></pre></div>
<p>[!]重要提示: 再次强调, 不要使用yara的<code>entrypoint</code>, 请在导入PE或ELF文件后使用对应的<code>pe.entry_point</code>和<code>elf.entry_point</code></p>
<h3 id="_25">访问指定位置的数据<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h3>
<p>如果你想从特定偏移位置读取数据, 并将其存为一个变量. 那么你可以使用以下任何一个方式:</p>
<div class="highlight"><pre><span></span><code>int8(&lt;offset or virtual address&gt;)
int16(&lt;offset or virtual address&gt;)
int32(&lt;offset or virtual address&gt;)

uint8(&lt;offset or virtual address&gt;)
uint16(&lt;offset or virtual address&gt;)
uint32(&lt;offset or virtual address&gt;)

int8be(&lt;offset or virtual address&gt;)
int16be(&lt;offset or virtual address&gt;)
int32be(&lt;offset or virtual address&gt;)

uint8be(&lt;offset or virtual address&gt;)
uint16be(&lt;offset or virtual address&gt;)
uint32be(&lt;offset or virtual address&gt;)
</code></pre></div>
<p>数据存储默认以小端序, 如果你想要读取大端序的整形数, 请使用下面几个以<code>be</code>结尾的对应函数.</p>
<p>参数<code>`可以是任何一个返回无符号整数的表达式, 包括可以是</code>uintXX`函数的返回值.</p>
<div class="highlight"><pre><span></span><code>rule IsPE
{
  condition:
     // MZ signature at offset 0 and ...
     uint16(0) == 0x5A4D and
     // ... PE signature at offset stored in MZ header at 0x3C
     uint32(uint32(0x3C)) == 0x00004550
}
</code></pre></div>
<h3 id="forof">for…of: 对许多字符串应用同一个条件<a class="headerlink" href="#forof" title="Permanent link">&para;</a></h3>
<p>要用for循环来检查一组字符串是否满足特定条件, 请使用如下语法:</p>
<div class="highlight"><pre><span></span><code>for num of string_set : ( boolean_expression )
</code></pre></div>
<p>对每个<code>string_set</code>的字符串, 都会计算<code>boolean_expression</code>的值, 并且这些值必须至少有1个为真.</p>
<p>当然你也可以使用其他关键字, 如<code>all</code>或<code>any</code>代替<code>num</code>来使用.</p>
<div class="highlight"><pre><span></span><code>for any of ($a,$b,$c) : ( $ at elf.entry_point  )
</code></pre></div>
<p><code>$</code>表示集合中的所有字符串. 本例中, 它是字符串<code>$a</code>, <code>$b</code>和<code>$c</code>.</p>
<p>你也可以使用符号<code>#</code>和<code>@</code>来引用每一个字符串的出现次数和首字符偏移量.</p>
<div class="highlight"><pre><span></span><code>for all of them : ( # &gt; 3 )
for all of ($a*) : ( @ &gt; @b )
</code></pre></div>
<h3 id="_26">迭代字符串出现次数<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h3>
<p>如果你想对偏移迭代并测试条件. 你可以如下操作:</p>
<div class="highlight"><pre><span></span><code>rule Three_Peat
{
    strings:
        $a = &quot;dummy1&quot;
        $b = &quot;dummy2&quot;

    condition:
        for all i in (1,2,3) : ( @a[i] + 10 == @b[i] )
}
</code></pre></div>
<p>这个规则说的是, <code>$b</code>出现前三个的字符串应当分别隔<code>$a</code>出现的前三个的字符串10个字节远. 另外一种写法如下:</p>
<div class="highlight"><pre><span></span><code>for all i in (1..3) : ( @a[i] + 10 == @b[i] )
</code></pre></div>
<p>我们也可以使用表达式. 在本例中, 我们迭代每一次出现的<code>$a</code>(记住, <code>#a</code>代表<code>$a</code>的出现次数). 该规则指定, 每一次<code>$a</code>都应当出现在文件的前100个字节内.</p>
<div class="highlight"><pre><span></span><code>for all i in (1..#a) : ( @a[i] &lt; 100 )
</code></pre></div>
<p>你也可以指定字符串的某一次出现需要满足条件(而非全部).</p>
<div class="highlight"><pre><span></span><code>for any i in (1..#a) : ( @a[i] &lt; 100 )
for 2 i in (1..#a) : ( @a[i] &lt; 100 )
</code></pre></div>
<h3 id="_27">引用其他规则<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h3>
<p>就像C语言中引用函数那样. 函数, 或是这里说的规则, 都必须在使用前进行定义.</p>
<div class="highlight"><pre><span></span><code>rule Rule1
{
    strings:
        $a = &quot;dummy1&quot;

    condition:
        $a
}

rule Rule2
{
    strings:
        $a = &quot;dummy2&quot;

    condition:
        $a and Rule1
}
</code></pre></div>
<h2 id="yara_1">Yara要点<a class="headerlink" href="#yara_1" title="Permanent link">&para;</a></h2>
<h3 id="_28">全局规则<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h3>
<p>Yara规则允许用户在所有规则中进行约束. 如果你希望所有规则都忽略掉那些超出特定大小限制的文件, 那么你可以对规则进行必要的修改, 或是编写一条像以下这样的全局规则:</p>
<div class="highlight"><pre><span></span><code>global rule SizeLimit
{
    condition:
        filesize &lt; 2MB
}
</code></pre></div>
<p>你可以根据需要定义各种全局规则. 这些规则会在其他规则之前运行.</p>
<h3 id="_29">私有规则<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h3>
<p>私有规则在匹配时没有任何输出. 当和其它规则成对引用时, 这样就可以使输出更为清楚. 比如为了判断文件是否恶意, 有这样一条私有规则, 要求文件必须是ELF文件. 一旦满足这个要求, 随后就会执行下一条规则. 但我们在输出里想看的并不是该文件它是不是ELF, 我们只想知道文件是否恶意, 那么私有规则就派上用场了. 要想创建一条私有规则, 只需要在<code>rule</code>前添加一个<code>private</code>即可.</p>
<div class="highlight"><pre><span></span><code>private rule PrivateRule
{
    ...
}
</code></pre></div>
<h3 id="_30">规则标签<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h3>
<p>如果你只想查看<code>ruleName</code>类型的规则输出, 你可以对你的规则打上标签</p>
<div class="highlight"><pre><span></span><code>rule TagsExample1 : Foo Bar Baz
{
    ...
}

rule TagsExample2 : Bar
{
    ...
}
</code></pre></div>
<h3 id="_31">元数据<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h3>
<p>Yara允许在规则中存储一些额外数据.</p>
<div class="highlight"><pre><span></span><code>rule MetadataExample
{
    meta:
        my_identifier_1 = &quot;Some string data&quot;
        my_identifier_2 = 24
        my_identifier_3 = true

    strings:
        $my_text_string = &quot;text here&quot;
        $my_hex_string = { E2 34 A1 C8 23 FB }

    condition:
        $my_text_string or $my_hex_string
}
</code></pre></div>
<h3 id="_32">使用模块<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h3>
<p>一些模块由YARA官方发布, 比如<code>PE</code>和<code>Cukoo</code>模块. 这些模块就如python那样导入即可, 不过在导入时模块名需要添加双引号</p>
<div class="highlight"><pre><span></span><code>import &quot;pe&quot;
import &quot;cuckoo&quot;
</code></pre></div>
<p>一旦模块成功导入, 你就可以在函数前加模块名, 来使用这些功能.</p>
<div class="highlight"><pre><span></span><code>pe.entry_point == 0x1000
cuckoo.http_request(/someregexp/)
</code></pre></div>
<h3 id="_33">未定义的值<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h3>
<p>一些值在运行时保留为<code>undefined</code>. 如果以下规则在ELF文件上执行并找到对应的字符串, 那么它的结果相当于<code>TRUE &amp; Undefined</code>.</p>
<div class="highlight"><pre><span></span><code>import &quot;pe&quot;

rule Test
{
  strings:
      $a = &quot;some string&quot;

  condition:
      $a and pe.entry_point == 0x1000
}
</code></pre></div>
<p>所以在用的时候要注意咯!</p>
<h3 id="_34">外部变量<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h3>
<p>外部变量允许你定义一些, 依赖于<code>第三方</code>提供值的规则.</p>
<div class="highlight"><pre><span></span><code>rule ExternalVariable1
{
    condition:
       ext_var == 10
}
</code></pre></div>
<p><code>ext_var</code>是一个外部变量, 它在运行时会分配有一个值, (见命令行的<code>-d</code>选项以及yara-python中<code>compile</code>和<code>match</code>方法的参数). 外部变量可以是<code>int</code>, <code>str</code>或<code>boolean</code>类型</p>
<p>外部变量可以和操作符<code>contains</code>和<code>matches</code>一起使用. <code>contains</code>在字符串包含特定子串的情况下返回<code>true</code>. 而<code>matches</code>在字符串匹配给定的正则表达式时返回<code>true</code>.</p>
<div class="highlight"><pre><span></span><code>rule ExternalVariable2
{
    condition:
        string_ext_var contains &quot;text&quot;
}

rule ExternalVariable3
{
    condition:
        string_ext_var matches /[a-z]+/
}
</code></pre></div>
<p>你也可以将<code>matches</code>操作符和正则表达式一起使用</p>
<div class="highlight"><pre><span></span><code>rule ExternalVariableExample5
{
    condition:
        /* case insensitive single-line mode */
        string_ext_var matches /[a-z]+/is
}
</code></pre></div>
<p><code>/[a-z]+/is</code>中的<code>i</code>表示匹配时不区分大小写. <code>s</code>表示是在单行(single line)模式</p>
<p>记住, 你必须在运行时定义好所有的外部变量. 你可以使用<code>-d</code>参数来指定.</p>
<h3 id="_35">文件包含<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h3>
<p>当然在yara规则里你可以使用类似C语言的导入方式(#include, 不过yara中并不使用<code>#</code>号来包含所需的文件, 而是用双引号引起来)来包含其他文件. 你可以在包含时使用相对路径或绝对路径. 如果是windows系统, 甚至还可以是驱动设备的路径.</p>
<div class="highlight"><pre><span></span><code>include &quot;Migos.yar&quot;
include &quot;../CardiB.yar&quot;
include &quot;/home/user/yara/IsRapper.yar&quot;
include &quot;c:\\yara\\includes\\oldRappers.yar&quot;
include &quot;c://yara/includes/oldRappers.yar&quot;
</code></pre></div>
<h2 id="_36">总结<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h2>
<p>好吧. 现在你应该知道如何写一些Yara规则了.
这里有一些恶意软件的仓库, 规则和工具, 可以让你来生成yara规则. 如果你安装了<code>yarGem</code>, 你只需要将它指向到恶意软件, 它就会为该恶意软件生成一个签名. 如果你想捕捉一个恶意软件家族, 你最好是将规则推广到整个家族去.</p>
<p>资源:</p>
<ul>
<li><a href="https://github.com/Yara-Rules/rules">Yara-Rules/rules</a></li>
<li><a href="https://www.bsk-consulting.de/2015/02/16/write-simple-sound-yara-rules/">How to Write Simple but Sound Yara Rules - BSK Consulting GmbH</a></li>
<li><a href="https://www.f-secure.com/v-descs/worm_w32_downadup_al.shtml">descs/worm_w32_downadup_al.shtml</a></li>
<li><a href="https://www.f-secure.com/v-descs/worm_w32_downadup.shtml">https://www.f-secure.com/v-descs/worm_w32_downadup.shtml</a></li>
<li><a href="https://support.microsoft.com/en-us/help/962007/virus-alert-about-the-win32-conficker-worm">https://support.microsoft.com/en-us/help/962007/virus-alert-about-the-win32-conficker-worm</a></li>
<li><a href="https://www.f-secure.com/v-descs/worm_w32_downadup_a.shtml">https://www.f-secure.com/v-descs/worm_w32_downadup_a.shtml</a></li>
<li><a href="https://www.f-secure.com/v-descs/worm_w32_downadup_gen.shtml">https://www.f-secure.com/v-descs/worm_w32_downadup_gen.shtml</a></li>
<li><a href="https://www.f-secure.com/v-descs/worm_w32_downaduprun_a.shtml">https://www.f-secure.com/v-descs/worm_w32_downaduprun_a.shtml</a></li>
</ul>
<p>Yara:</p>
<ul>
<li><a href="https://www.experts-exchange.com/questions/29042297/How-to-test-yara-rule.html">How to test yara rule?</a></li>
<li><a href="https://www.securityartwork.es/2013/10/11/yara-101/">https://www.securityartwork.es/2013/10/11/yara-101/</a></li>
<li><a href="https://stixproject.github.io/documentation/idioms/yara-test-mechanism/">https://stixproject.github.io/documentation/idioms/yara-test-mechanism/</a></li>
<li><a href="https://github.com/Neo23x0/yarGen">Neo23x0/yarGen</a></li>
<li><a href="https://github.com/radare/radare2/blob/master/doc/yara.md">radare/radare2/blob/master/doc/yara.md</a></li>
<li><a href="https://www.bsk-consulting.de/2015/02/16/write-simple-sound-yara-rules/">How to Write Simple but Sound Yara Rules - BSK Consulting GmbH</a></li>
<li><a href="https://www.bsk-consulting.de/2015/10/17/how-to-write-simple-but-sound-yara-rules-part-2/">How to Write Simple but Sound Yara Rules - Part 2 - BSK Consulting GmbH</a></li>
<li><a href="https://www.bsk-consulting.de/2016/04/15/how-to-write-simple-but-sound-yara-rules-part-3/">How to Write Simple but Sound Yara Rules – Part 3 - BSK Consulting GmbH</a></li>
</ul>
<p>xxd:</p>
<ul>
<li><a href="https://www.systutorials.com/docs/linux/man/1-xxd/">https://www.systutorials.com/docs/linux/man/1-xxd</a></li>
</ul>
<p>比较命令</p>
<div class="highlight"><pre><span></span><code>awk ‘FNR==NR{a[$1];next}($1 in a){print}’ malcourse.strings zoo.conficker.strings &gt; same-strings
</code></pre></div>
<p>恶意软件仓库</p>
<ul>
<li><a href="https://github.com/Malshare/MalShare-Toolkit">Malshare/MalShare-Toolkit</a></li>
<li><a href="http://malshare.com/about.php">http://malshare.com/about.php</a></li>
</ul>
<p>原文链接: <a href="https://0x00sec.org/t/tutorial-creating-yara-signatures-for-malware-detection/5453">Tutorial: Creating Yara Signatures for Malware Detection</a>
编译: 看雪翻译小组 Vancir
校对: 看雪翻译小组 Skeep</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../../../windows_core_programming/multi_thread/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 多线程有关" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              多线程有关
            </div>
          </div>
        </a>
      
      
        
        <a href="../yara_docs/" class="md-footer__link md-footer__link--next" aria-label="下一页: 官方文档与signature" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              官方文档与signature
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.tabs", "header.autohide", "navigation.expand"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../../assets/javascripts/workers/search.477d984a.min.js", "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.82b56eb2.min.js"></script>
      
    
  </body>
</html>